name: Scheduled Email Delivery

on:
  schedule:
    # 毎時0分に実行（UTC）
    # Firestoreのスケジュール設定に基づいて送信判定
    - cron: '0 * * * *'

  # 手動実行も可能
  workflow_dispatch:

jobs:
  send-emails:
    runs-on: ubuntu-latest
    steps:
      - name: Send Scheduled Emails
        run: |
          echo "Checking for emails to send..."
          response=$(curl -X GET "${{ secrets.APP_URL }}/api/cron/send-emails?secret=${{ secrets.CRON_SECRET }}")
          echo "$response"

          # レスポンスをログに出力
          echo "Email sending completed."
